var level_js = JSON.parse('{"rigidBodies":[{"name":"Name","imagePath":"../egghunt-01.png","origin":{"x":0,"y":0},"polygons":[[{"x":0.8500001430511475,"y":0.7337499260902405},{"x":0.8750000596046448,"y":0.8237500190734863},{"x":0.7900000214576721,"y":0.7212499976158142}],[{"x":0.7900000214576721,"y":0.7212499976158142},{"x":0.8400001525878906,"y":0.6637499928474426},{"x":0.8500001430511475,"y":0.7337499260902405}],[{"x":0.7900000214576721,"y":0.7212499976158142},{"x":0.7624999284744263,"y":0.6362500190734863},{"x":0.7975000143051147,"y":0.5537500381469727},{"x":0.8575000762939453,"y":0.6162499189376831},{"x":0.8400001525878906,"y":0.6637499928474426}],[{"x":0.7975000143051147,"y":0.5537500381469727},{"x":0.8975001573562622,"y":0.6037499904632568},{"x":0.8575000762939453,"y":0.6162499189376831}],[{"x":0.7975000143051147,"y":0.5537500381469727},{"x":0.9050000905990601,"y":0.49125000834465027},{"x":1.0199999809265137,"y":0.5262500643730164},{"x":0.9400001764297485,"y":0.6187499165534973},{"x":0.8975001573562622,"y":0.6037499904632568}],[{"x":1.0199999809265137,"y":0.5262500643730164},{"x":1.0399999618530273,"y":0.5437500476837158},{"x":1,"y":0.701249897480011},{"x":0.9400001764297485,"y":0.6187499165534973}],[{"x":1.0399999618530273,"y":0.5437500476837158},{"x":1.0824999809265137,"y":0.5737500786781311},{"x":1.0325000286102295,"y":0.7887499332427979},{"x":1,"y":0.701249897480011}],[{"x":0.6525000333786011,"y":0.14625003933906555},{"x":0.4400000274181366,"y":0.0012499988079071045},{"x":0.7099998593330383,"y":-0.07625001668930054},{"x":0.8450000286102295,"y":0.13375002145767212}],[{"x":0.8450000286102295,"y":0.13375002145767212},{"x":0.8250000476837158,"y":0.3062500059604645},{"x":0.7649999856948853,"y":0.3812499940395355},{"x":0.6875,"y":0.2837499976158142},{"x":0.6525000333786011,"y":0.14625003933906555}],[{"x":0.7649999856948853,"y":0.3812499940395355},{"x":0.6399999856948853,"y":0.46875},{"x":0.6250000596046448,"y":0.3787500262260437},{"x":0.6875,"y":0.2837499976158142}],[{"x":0.6399999856948853,"y":0.46875},{"x":0.4574999511241913,"y":0.4387499988079071},{"x":0.4599999785423279,"y":0.3787500262260437},{"x":0.6250000596046448,"y":0.3787500262260437}],[{"x":0.4574999511241913,"y":0.4387499988079071},{"x":0.37999993562698364,"y":0.3762500584125519},{"x":0.36249998211860657,"y":0.2812500596046448},{"x":0.3974999785423279,"y":0.27375006675720215},{"x":0.4599999785423279,"y":0.3787500262260437}],[{"x":0.36249998211860657,"y":0.2812500596046448},{"x":0.41499996185302734,"y":0.23125001788139343},{"x":0.3974999785423279,"y":0.27375006675720215}],[{"x":-0.0025000572204589844,"y":0.8387500047683716},{"x":0.10999998450279236,"y":0.8387500047683716},{"x":0.19749999046325684,"y":0.8812499642372131},{"x":-2.9802322387695312E-8,"y":0.8812499642372131}]],"circles":[{"cx":0.32499998807907104,"cy":0.5687500238418579,"r":0.04506940394639969},{"cx":0.5824999809265137,"cy":0.6787500381469727,"r":0.041003044694662094},{"cx":0.5725000500679016,"cy":0.2237500250339508,"r":0.050621092319488525},{"cx":0.19999998807907104,"cy":0.3812499940395355,"r":0.05303297936916351}],"shapes":[{"type":"POLYGON","vertices":[{"x":1,"y":0.701249897480011},{"x":0.9400001764297485,"y":0.6187499165534973},{"x":0.8975001573562622,"y":0.6037499904632568},{"x":0.8575000762939453,"y":0.6162499189376831},{"x":0.8400001525878906,"y":0.6637499928474426},{"x":0.8500001430511475,"y":0.7337499260902405},{"x":0.8750000596046448,"y":0.8237500190734863},{"x":0.7900000214576721,"y":0.7212499976158142},{"x":0.7624999284744263,"y":0.6362500190734863},{"x":0.7975000143051147,"y":0.5537500381469727},{"x":0.9050000905990601,"y":0.49125000834465027},{"x":1.0199999809265137,"y":0.5262500643730164},{"x":1.0399999618530273,"y":0.5437500476837158},{"x":1.0824999809265137,"y":0.5737500786781311},{"x":1.0325000286102295,"y":0.7887499332427979}]},{"type":"POLYGON","vertices":[{"x":0.41499996185302734,"y":0.23125001788139343},{"x":0.3974999785423279,"y":0.27375006675720215},{"x":0.4599999785423279,"y":0.3787500262260437},{"x":0.6250000596046448,"y":0.3787500262260437},{"x":0.6875,"y":0.2837499976158142},{"x":0.6525000333786011,"y":0.14625003933906555},{"x":0.4400000274181366,"y":0.0012499988079071045},{"x":0.7099998593330383,"y":-0.07625001668930054},{"x":0.8450000286102295,"y":0.13375002145767212},{"x":0.8250000476837158,"y":0.3062500059604645},{"x":0.7649999856948853,"y":0.3812499940395355},{"x":0.6399999856948853,"y":0.46875},{"x":0.4574999511241913,"y":0.4387499988079071},{"x":0.37999993562698364,"y":0.3762500584125519},{"x":0.36249998211860657,"y":0.2812500596046448}]},{"type":"POLYGON","vertices":[{"x":-0.0025000572204589844,"y":0.8387500047683716},{"x":0.10999998450279236,"y":0.8387500047683716},{"x":0.19749999046325684,"y":0.8812499642372131},{"x":-2.9802322387695312E-8,"y":0.8812499642372131}]},{"type":"CIRCLE","vertices":[{"x":0.32499998807907104,"y":0.5687500238418579},{"x":0.3675000071525574,"y":0.5537500381469727}]},{"type":"CIRCLE","vertices":[{"x":0.5824999809265137,"y":0.6787500381469727},{"x":0.6149999499320984,"y":0.6537500023841858}]},{"type":"CIRCLE","vertices":[{"x":0.5725000500679016,"y":0.2237500250339508},{"x":0.6200000047683716,"y":0.20625004172325134}]},{"type":"CIRCLE","vertices":[{"x":0.19999998807907104,"y":0.3812499940395355},{"x":0.23749998211860657,"y":0.3437500298023224}]}]}],"dynamicObjects":[]}');

var grounds = [1, 1, 1, 1];
var level_dynamic_obj = [];
var level_collectable_obj = [];
var level_collectable_score = [];
var startBody;
var endBody;

var start_impulse = [0, 15];

function loadLevel(world) {
    var b2Vec2 = Box2D.Common.Math.b2Vec2,
        b2AABB = Box2D.Collision.b2AABB,
        b2BodyDef = Box2D.Dynamics.b2BodyDef,
        b2Body = Box2D.Dynamics.b2Body,
        b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
        b2Fixture = Box2D.Dynamics.b2Fixture,
        b2World = Box2D.Dynamics.b2World,
        b2MassData = Box2D.Collision.Shapes.b2MassData,
        b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
        b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
        b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
        b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
        b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef,
        b2DistanceJointDef = Box2D.Dynamics.Joints.b2DistanceJointDef;

    var fixDef = new b2FixtureDef;
    var bodyDef = new b2BodyDef;

    // Create grounds;
    fixDef.density = 1.0;
    fixDef.friction = 0.8;
    fixDef.restitution = 0.2;
    bodyDef.type = b2Body.b2_staticBody;
    fixDef.shape = new b2PolygonShape;
    fixDef.shape.SetAsBox(20, 2);
    bodyDef.position.Set(10, 16.8);
    if (grounds[0] == 1)
        world.CreateBody(bodyDef).CreateFixture(fixDef);
    bodyDef.position.Set(10, -1.8);
    if (grounds[1] == 1)
        world.CreateBody(bodyDef).CreateFixture(fixDef);
    fixDef.shape.SetAsBox(2, 14);
    bodyDef.position.Set(-1.8, 13);
    if (grounds[2] == 1)
        world.CreateBody(bodyDef).CreateFixture(fixDef);
    bodyDef.position.Set(28.5, 13);
    if (grounds[3] == 1)
        world.CreateBody(bodyDef).CreateFixture(fixDef);
    // Load static scene;
    fixDef.density = 1.0;
    fixDef.friction = 0.8;
    fixDef.restitution = 0.2;
    fixDef.shape = new b2PolygonShape;
    bodyDef.type = b2Body.b2_staticBody;
    polygons = level_js.rigidBodies[0].polygons;
    for (var i = 0; i < polygons.length; i++) {
        var points = [];
        for (var j = 0; j < polygons[i].length; j++) {
            var vec = new b2Vec2();
            vec.Set(polygons[i][j].x * canvas.width / 30, (canvas.height - polygons[i][j].y * canvas.height) / 30);
            points[j] = vec;
        }
        points = points.reverse();
        fixDef.shape.SetAsArray(points, points.length);
        bodyDef.position.Set(0, 0);
        world.CreateBody(bodyDef).CreateFixture(fixDef);
    }

    fixDef.density = 0.9;
    fixDef.friction = 0.001;
    fixDef.restitution = 0.0;
    bodyDef.type = b2Body.b2_dynamicBody;

    for (var i = 0; i < 1; ++i) {
        fixDef.shape = new b2CircleShape(0.5);
        bodyDef.position.x = 1;
        bodyDef.position.y = 1;
        var body = startBody = world.CreateBody(bodyDef);
        level_dynamic_obj.push(body);
        body.CreateFixture(fixDef);
    }

    bodyDef.type = b2Body.b2_staticBody;
    fixDef.isSensor = true;
    fixDef.shape = new b2CircleShape(0.75);
    circles = level_js.rigidBodies[0].circles;
    for (var i = 0; i < circles.length; i++) {
        bodyDef.position.x = circles[i].cx * 800 / 30;
        bodyDef.position.y = (1.0 - circles[i].cy) * 450 / 30;
        var body = world.CreateBody(bodyDef);
        body.CreateFixture(fixDef);
        level_collectable_obj.push(body);
        level_collectable_score.push(1);
    }

    fixDef.shape = new b2PolygonShape();
    fixDef.shape.SetAsBox(1, 1);
    bodyDef.position.x = 120 / 30;
    bodyDef.position.y = 400 / 30;
    var body = world.CreateBody(bodyDef);
    body.CreateFixture(fixDef);
    endBody = body;
}
